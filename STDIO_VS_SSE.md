# stdio vs SSE: MCPè¿æ¥å¤±è´¥åˆ†æä¸è§£å†³æ–¹æ¡ˆ

**æ—¥æœŸ**: 2025-10-17
**é—®é¢˜**: stdioç±»å‹çš„MCPæœåŠ¡å™¨è¿æ¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**: åˆ‡æ¢åˆ°SSE (Server-Sent Events) å®ç°

---

## ğŸ” stdioå¤±è´¥åŸå› åˆ†æ

### é—®é¢˜æè¿°
é…ç½®ä¸ºstdioç±»å‹çš„`edge-ai-assistant` MCPæœåŠ¡å™¨æ— æ³•è¿æ¥åˆ°Claude Codeï¼š
```
Failed to reconnect to edge-ai-assistant.
```

### å¯èƒ½çš„åŸå› 

#### 1. **Claude Codeå¯¹stdioçš„ç‰¹æ®Šå¤„ç†**
Claude Codeå¯èƒ½å¯¹stdioç±»å‹çš„MCPæœåŠ¡å™¨æœ‰ç‰¹æ®Šçš„å¯åŠ¨å’Œç®¡ç†æœºåˆ¶ï¼Œå¯èƒ½åŒ…æ‹¬ï¼š
- è¿›ç¨‹ç®¡ç†å’Œç›‘æ§
- ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ä¼ é€’
- stdin/stdoutçš„ç‰¹æ®Šç¼–ç æˆ–ç¼“å†²
- è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 2. **Windowsç¯å¢ƒçš„stdioå…¼å®¹æ€§é—®é¢˜**
åœ¨Windowsä¸Šï¼Œstdioé‡å®šå‘å¯èƒ½å­˜åœ¨é—®é¢˜ï¼š
- å‘½ä»¤è·¯å¾„è½¬ä¹‰ï¼ˆç©ºæ ¼ã€åæ–œæ ï¼‰
- è¿›ç¨‹åˆ›å»ºæ–¹å¼ï¼ˆcmd.exe vs PowerShell vsç›´æ¥å¯åŠ¨ï¼‰
- ç¯å¢ƒå˜é‡ç»§æ‰¿

#### 3. **Node.jsè·¯å¾„å’Œå·¥ä½œç›®å½•**
å³ä½¿ä½¿ç”¨å®Œæ•´è·¯å¾„ `C:\Program Files\nodejs\node.exe`ï¼Œä»ç„¶å¯èƒ½æœ‰ï¼š
- å·¥ä½œç›®å½•ä¸æ­£ç¡®
- ç›¸å¯¹è·¯å¾„è§£æé—®é¢˜
- ç¯å¢ƒå˜é‡PATHé—®é¢˜

#### 4. **ä¸å…¶ä»–stdio MCPçš„å¯¹æ¯”**

**æˆåŠŸçš„ä¾‹å­ - Playwright MCP**:
```json
"playwright": {
  "type": "stdio",
  "command": "npx",
  "args": ["@executeautomation/playwright-mcp-server"]
}
```

**æˆ‘ä»¬çš„é…ç½®**:
```json
"edge-ai-assistant": {
  "type": "stdio",
  "command": "C:\\Program Files\\nodejs\\node.exe",
  "args": ["C:\\Users\\1\\edge-ai-assistant\\mcp-server\\server.js"],
  "env": {"NATIVE_HOST_URL": "http://localhost:9999"}
}
```

**å…³é”®å·®å¼‚**:
- Playwrightä½¿ç”¨`npx`ï¼ˆnpmåŒ…ç®¡ç†å™¨ï¼‰ï¼Œè¿™æ˜¯ç»è¿‡æµ‹è¯•çš„å¯åŠ¨æ–¹å¼
- æˆ‘ä»¬ç›´æ¥ä½¿ç”¨`node`ï¼Œå¯èƒ½ç»•è¿‡äº†æŸäº›åˆå§‹åŒ–æ­¥éª¤
- Playwrightå¯èƒ½åœ¨å…¶npmåŒ…ä¸­å¤„ç†äº†Windowså…¼å®¹æ€§é—®é¢˜

### ä¸ºä»€ä¹ˆmemory-portalçš„stdioèƒ½å·¥ä½œï¼Ÿ

æ ¹æ®ç”¨æˆ·æåˆ°"æˆ‘ä»¬ä¹‹å‰çš„è®°å¿†MCPçš„åˆæ­¥å®ç°ï¼Œç”¨çš„stdioå°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜"ï¼Œä½†å®é™…é…ç½®æ˜¾ç¤ºï¼š
```json
"memory-portal": {
  "type": "sse",
  "url": "http://localhost:3100/sse"
}
```

**memory-portalå®é™…ä¸Šç”¨çš„æ˜¯SSEï¼Œä¸æ˜¯stdioï¼** è¿™è¯å®äº†SSEæ›´å¯é ã€‚

---

## âœ… SSEè§£å†³æ–¹æ¡ˆ

### ä¸ºä»€ä¹ˆé€‰æ‹©SSEï¼Ÿ

#### 1. **æ›´ç®€å•çš„åè®®**
- HTTP-basedï¼Œæˆç†Ÿç¨³å®š
- æ— éœ€å¤„ç†stdioçš„å¤æ‚æ€§
- æ— éœ€æ‹…å¿ƒè¿›ç¨‹ç®¡ç†

#### 2. **å·²éªŒè¯çš„æ–¹æ¡ˆ**
- memory-portalä½¿ç”¨SSEæˆåŠŸè¿è¡Œ
- HTTPåè®®åœ¨Windowsä¸Šæ›´å¯é 
- æ›´å®¹æ˜“è°ƒè¯•å’Œç›‘æ§

#### 3. **æ›´å¥½çš„æ¶æ„**
- MCP Serverç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–Claude Codeè¿›ç¨‹ç®¡ç†
- å¯ä»¥æ‰‹åŠ¨å¯åŠ¨ã€é‡å¯ã€ç›‘æ§
- å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥å…±äº«åŒä¸€ä¸ªæœåŠ¡å™¨

#### 4. **é€‚åˆæˆ‘ä»¬çš„åœºæ™¯**
ç”¨æˆ·è¯´ï¼š"æ­£å¸¸æ¥çœ‹å¤šä¸ªå¯¹è¯ä¸ä¼šç«äº‰å¯¹äºä¸€ä¸ªçª—å£çš„æ“ä½œ"
- SSEå¤©ç„¶æ”¯æŒå¤šå®¢æˆ·ç«¯
- ä¸€ä¸ªMCP Serverå¯ä»¥æœåŠ¡å¤šä¸ªClaude Codeä¼šè¯
- æ— éœ€æ‹…å¿ƒstdioçš„ç‹¬å æ€§

---

## ğŸ“‹ SSEå®ç°ç»†èŠ‚

### æ¶æ„
```
Claude Code â†’ SSE (/sse) â†’ MCP Server (port 3200)
                            â†“
                        HTTP POST â†’ Native Host (port 9999)
                                    â†“
                                Edge Extension â†’ Browser
```

### ç«¯ç‚¹
- **SSEç«¯ç‚¹**: `http://localhost:3200/sse`
- **Messageç«¯ç‚¹**: `http://localhost:3200/message`
- **Healthç«¯ç‚¹**: `http://localhost:3200/health`

### é…ç½®
```json
{
  "edge-ai-assistant": {
    "type": "sse",
    "url": "http://localhost:3200/sse"
  }
}
```

### å¯åŠ¨æ–¹å¼
```bash
# Linux/Mac
./start-mcp-server.sh

# Windows
start-mcp-server.bat
```

---

## ğŸ”„ è¿ç§»æ­¥éª¤

### 1. åˆ›å»ºSSEç‰ˆæœ¬çš„MCP Server
âœ… å·²å®Œæˆï¼š`mcp-server/server-sse.js`

### 2. æµ‹è¯•SSE Server
```bash
# å¯åŠ¨æœåŠ¡å™¨
$ NATIVE_HOST_URL=http://localhost:9999 MCP_PORT=3200 node mcp-server/server-sse.js
âœ… Edge AI Assistant MCP Server (SSE) listening on http://localhost:3200

# æµ‹è¯•å¥åº·æ£€æŸ¥
$ curl http://localhost:3200/health
âœ… {"status":"ok","service":"edge-ai-assistant-mcp","clients":0}

# æµ‹è¯•MCPåè®®
$ curl -X POST http://localhost:3200/message -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize",...}'
âœ… {"jsonrpc":"2.0","id":1,"result":{...}}
```

### 3. æ›´æ–°é…ç½®
âœ… å·²å®Œæˆï¼š`.claude.json` æ›´æ–°ä¸ºSSEé…ç½®

### 4. é‡å¯Claude Code
â³ å¾…ç”¨æˆ·æ‰§è¡Œ

---

## ğŸ“Š stdio vs SSE å¯¹æ¯”

| ç‰¹æ€§ | stdio | SSE |
|-----|-------|-----|
| **åè®®** | stdin/stdoutæµ | HTTP + Server-Sent Events |
| **è¿›ç¨‹ç®¡ç†** | ç”±Claude Codeç®¡ç† | ç‹¬ç«‹è¿è¡Œ |
| **è°ƒè¯•éš¾åº¦** | å›°éš¾ï¼ˆæ— æ³•ç›´æ¥æµ‹è¯•ï¼‰ | ç®€å•ï¼ˆcurlå³å¯æµ‹è¯•ï¼‰ |
| **å¤šå®¢æˆ·ç«¯** | ä¸æ”¯æŒ | æ”¯æŒ |
| **Windowså…¼å®¹** | å¤æ‚ | ç®€å• |
| **ç›‘æ§** | å›°éš¾ | ç®€å•ï¼ˆhealth endpointï¼‰ |
| **å¯åŠ¨æ–¹å¼** | è‡ªåŠ¨å¯åŠ¨ | æ‰‹åŠ¨æˆ–è‡ªåŠ¨å¯åŠ¨ |
| **é”™è¯¯å¤„ç†** | å¤æ‚ | ç®€å•ï¼ˆHTTPçŠ¶æ€ç ï¼‰ |

---

## ğŸ’¡ ç»éªŒæ•™è®­

### 1. stdioä¸æ˜¯é“¶å¼¹
è™½ç„¶stdioæ˜¯MCPçš„æ ‡å‡†æ–¹å¼ä¹‹ä¸€ï¼Œä½†åœ¨æŸäº›ç¯å¢ƒä¸‹ï¼ˆç‰¹åˆ«æ˜¯Windowsï¼‰å¯èƒ½é‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚

### 2. SSEæ›´é€‚åˆHTTPæœåŠ¡åœºæ™¯
æˆ‘ä»¬çš„æ¶æ„æœ¬è´¨ä¸Šæ˜¯HTTPæœåŠ¡ï¼ˆNative Hostï¼‰ï¼ŒSSEæ˜¯æ›´è‡ªç„¶çš„é€‰æ‹©ã€‚

### 3. ç‹¬ç«‹è¿›ç¨‹ç®¡ç†æ›´çµæ´»
SSEéœ€è¦æ‰‹åŠ¨å¯åŠ¨MCP Serverï¼Œä½†è¿™å¸¦æ¥äº†ï¼š
- æ›´å¥½çš„æ§åˆ¶
- æ›´å®¹æ˜“è°ƒè¯•
- æ›´æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 4. å‚è€ƒæˆåŠŸæ¡ˆä¾‹
memory-portalä½¿ç”¨SSEæˆåŠŸè¿è¡Œï¼Œè¿™æ˜¯é€‰æ‹©SSEçš„é‡è¦ä¾æ®ã€‚

---

## ğŸ¯ åç»­ä¼˜åŒ–

### 1. è‡ªåŠ¨å¯åŠ¨
å¯ä»¥åˆ›å»ºWindowsæœåŠ¡æˆ–å¼€æœºè‡ªå¯åŠ¨è„šæœ¬ã€‚

### 2. è¿›ç¨‹ç®¡ç†
ä½¿ç”¨pm2æˆ–ç±»ä¼¼å·¥å…·ç®¡ç†MCP Serverè¿›ç¨‹ï¼š
```bash
pm2 start mcp-server/server-sse.js --name edge-ai-mcp
pm2 save
pm2 startup
```

### 3. æ—¥å¿—è®°å½•
æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä¾¿äºæ•…éšœæ’æŸ¥ã€‚

### 4. å¥åº·æ£€æŸ¥
å®šæœŸæ£€æŸ¥Native Hostå’ŒMCP Serverçš„å¥åº·çŠ¶æ€ã€‚

---

## ğŸ“ æ€»ç»“

**stdioå¤±è´¥çš„æ ¹æœ¬åŸå› **:
- Windowsç¯å¢ƒä¸‹çš„è¿›ç¨‹å¯åŠ¨å…¼å®¹æ€§é—®é¢˜
- Claude Codeå¯¹stdioçš„ç‰¹æ®Šå¤„ç†å¯èƒ½ä¸æˆ‘ä»¬çš„å®ç°ä¸å…¼å®¹
- ç›´æ¥ä½¿ç”¨nodeå¯èƒ½ç»•è¿‡äº†å¿…è¦çš„åˆå§‹åŒ–æ­¥éª¤

**SSEæˆåŠŸçš„åŸå› **:
- HTTPåè®®æˆç†Ÿç¨³å®š
- ç‹¬ç«‹è¿›ç¨‹æ›´å®¹æ˜“ç®¡ç†
- å·²æœ‰æˆåŠŸæ¡ˆä¾‹ï¼ˆmemory-portalï¼‰
- æ›´é€‚åˆæˆ‘ä»¬çš„HTTP-basedæ¶æ„

**æœ€ç»ˆé€‰æ‹©**: SSE âœ…

---

*åˆ›å»ºæ—¶é—´: 2025-10-17*
*ä½œè€…: Claude*
*çŠ¶æ€: SSEç‰ˆæœ¬å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡*
